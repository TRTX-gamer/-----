/*
06_定时器中断
    功能
        利用定时器进行精准的1秒led闪烁
    目的
        1 学习计时器
        2 复习中断
*/

#include "reg52.h"

////////////////////////////////////////////////////////////////////////////////
typedef unsigned int u16;
typedef unsigned char u8;

#define led P2
////////////////////////////////////////////////////////////////////////////////
u16 ssec = 0, sec = 0; //毫秒，秒

////////////////////////////////////////////////////////////////////////////////
void Timer0Init(void);

////////////////////////////////////////////////////////////////////////////////

/*******************************************************************************
* 函 数 名      : main
* 函数功能      : 主函数
* 输    入      : 
* 输    出      : 
*******************************************************************************/
void main(void)
{
    Timer0Init();
    led = 0XFF;

    while (1)
    {
        if (ssec == 500)
        {
            sec += 1;
            ssec = 0;
            led = ~led;
        }
    }
}

/*******************************************************************************
* 函 数 名      : Timer0Init
* 函数功能      : 定时器初始化函数
* 输    入      : 
* 输    出      : 
*******************************************************************************/
void Timer0Init(void)
{
    TMOD |= 0X01; // 设置工作方式为1，16位定时/计数器
    TL0 = 0X00;   // 定时器0低八位赋初值
    TH0 = 0XDC;   // 定时器0高八位赋初值
    ET0 = 1;      // 定时器0中断打开
    EA = 1;       // 总中断打开
    TR0 = 1;      // 控制定时器，1为打开
}

/*******************************************************************************
* 函 数 名      : Timer0
* 函数功能      : 计数器中断0函数
* 输    入      : 
* 输    出      : 
*******************************************************************************/
void Timer0(void) interrupt 1
{
    TL0 = 0X00; // 复位
    TH0 = 0XDC;
    ssec += 10; // 记录+10ms
}

// 2021年8月10号17点04分